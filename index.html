<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام متابعة العملاء</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 32px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        .buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        button, .file-label {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        .btn-add { background: #667eea; color: white; }
        .btn-add:hover { background: #5568d3; }
        .btn-export { background: #10b981; color: white; }
        .btn-export:hover { background: #059669; }
        .btn-save { background: #8b5cf6; color: white; }
        .btn-save:hover { background: #7c3aed; }
        .file-label { background: #f59e0b; color: white; }
        .file-label:hover { background: #d97706; }
        input[type="file"] { display: none; }
        .form-box {
            background: linear-gradient(135deg, #e0e7ff 0%, #ede9fe 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #c7d2fe;
        }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #374151;
            font-size: 14px;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            padding-top: 25px;
        }
        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
        }
        .client-card {
            background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
            border: 2px solid #e5e7eb;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .client-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 20px;
        }
        .client-title {
            font-size: 24px;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 10px;
        }
        .status-badge {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            border: 2px solid;
        }
        .status-working { background: #dbeafe; color: #1e40af; border-color: #93c5fd; }
        .status-waiting { background: #fef3c7; color: #92400e; border-color: #fcd34d; }
        .status-complete { background: #d1fae5; color: #065f46; border-color: #6ee7b7; }
        .status-late { background: #fee2e2; color: #991b1b; border-color: #fca5a5; }
        .status-cancel { background: #f3f4f6; color: #374151; border-color: #d1d5db; }
        .btn-delete {
            background: #ef4444;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-delete:hover { background: #dc2626; }
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .content-box {
            padding: 20px;
            border-radius: 12px;
            border: 2px solid;
        }
        .content-box h4 {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .box-posts { background: #dbeafe; border-color: #93c5fd; }
        .box-posts .dot { background: #2563eb; }
        .box-reels { background: #f3e8ff; border-color: #d8b4fe; }
        .box-reels .dot { background: #9333ea; }
        .box-stories { background: #fce7f3; border-color: #f9a8d4; }
        .box-stories .dot { background: #db2777; }
        .progress-numbers {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 13px;
        }
        .progress-numbers input {
            width: 60px;
            padding: 4px;
            text-align: center;
            border: 1px solid #d1d5db;
            border-radius: 6px;
        }
        .progress-bar-container {
            width: 100%;
            height: 12px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s;
        }
        .progress-blue { background: #2563eb; }
        .progress-purple { background: #9333ea; }
        .progress-pink { background: #db2777; }
        .progress-green { background: #059669; }
        .media-box {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border: 2px solid #6ee7b7;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
        }
        .media-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .media-badge {
            background: #059669;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        .media-item label {
            font-size: 12px;
            color: #065f46;
            display: block;
            margin-bottom: 5px;
        }
        .media-item input {
            width: 100%;
            padding: 8px;
            border: 2px solid #6ee7b7;
            border-radius: 8px;
        }
        .remaining {
            font-size: 24px;
            font-weight: bold;
            color: #059669;
        }
        .notes-box {
            margin-top: 15px;
        }
        .notes-box textarea {
            width: 100%;
            padding: 12px;
            background: #fef3c7;
            border: 2px solid #fcd34d;
            border-radius: 10px;
            resize: vertical;
            min-height: 60px;
        }
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }
        .empty-state .emoji {
            font-size: 80px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>📊 متابعة تقدم العمل مع العملاء</h1>
        <p class="subtitle">نظام إدارة المحتوى والميديا باينج</p>
        
        <div class="buttons">
            <button class="btn-add" onclick="toggleForm()">➕ عميل جديد</button>
            <button class="btn-export" onclick="exportCSV()">📥 تصدير Excel</button>
            <button class="btn-save" onclick="saveBackup()">💾 حفظ نسخة</button>
            <label class="file-label">
                📤 استعادة نسخة
                <input type="file" accept=".json" onchange="loadBackup(event)">
            </label>
        </div>

        <div id="addForm" style="display:none;" class="form-box">
            <h2 style="margin-bottom: 20px;">إضافة عميل جديد</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>اسم العميل *</label>
                    <input type="text" id="clientName" placeholder="اسم الشركة أو العميل">
                </div>
                <div class="form-group">
                    <label>البوستات المطلوبة</label>
                    <input type="number" id="postsReq" value="0">
                </div>
                <div class="form-group">
                    <label>البوستات المنجزة</label>
                    <input type="number" id="postsComp" value="0">
                </div>
                <div class="form-group">
                    <label>الريلز المطلوبة</label>
                    <input type="number" id="reelsReq" value="0">
                </div>
                <div class="form-group">
                    <label>الريلز المنجزة</label>
                    <input type="number" id="reelsComp" value="0">
                </div>
                <div class="form-group">
                    <label>الاستوريز المطلوبة</label>
                    <input type="number" id="storiesReq" value="0">
                </div>
                <div class="form-group">
                    <label>الاستوريز المنجزة</label>
                    <input type="number" id="storiesComp" value="0">
                </div>
                <div class="form-group checkbox-group">
                    <input type="checkbox" id="mediaBuying">
                    <label>يعمل معنا ميديا باينج</label>
                </div>
                <div class="form-group">
                    <label>ميزانية الميديا باينج</label>
                    <input type="number" id="mediaBudget" value="0">
                </div>
                <div class="form-group">
                    <label>المصروف</label>
                    <input type="number" id="mediaSpent" value="0">
                </div>
                <div class="form-group">
                    <label>الحالة</label>
                    <select id="status">
                        <option value="جاري العمل">جاري العمل</option>
                        <option value="في الانتظار">في الانتظار</option>
                        <option value="مكتمل">مكتمل</option>
                        <option value="متأخر">متأخر</option>
                        <option value="ملغي">ملغي</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>الموعد النهائي</label>
                    <input type="date" id="deadline">
                </div>
            </div>
            <div class="form-group" style="margin-top: 15px;">
                <label>ملاحظات</label>
                <textarea id="notes" rows="2" placeholder="أي ملاحظات إضافية"></textarea>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn-add" onclick="addClient()">إضافة العميل</button>
                <button class="btn-delete" onclick="toggleForm()">إلغاء</button>
            </div>
        </div>

        <div id="clientsList"></div>
    </div>

    <script>
        let clients = JSON.parse(localStorage.getItem('clients') || '[]');

        function saveData() {
            localStorage.setItem('clients', JSON.stringify(clients));
            render();
        }

        function toggleForm() {
            const form = document.getElementById('addForm');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        }

        function addClient() {
            const name = document.getElementById('clientName').value;
            if (!name) {
                alert('من فضلك أدخل اسم العميل');
                return;
            }

            clients.push({
                id: Date.now(),
                name: name,
                postsReq: +document.getElementById('postsReq').value,
                postsComp: +document.getElementById('postsComp').value,
                reelsReq: +document.getElementById('reelsReq').value,
                reelsComp: +document.getElementById('reelsComp').value,
                storiesReq: +document.getElementById('storiesReq').value,
                storiesComp: +document.getElementById('storiesComp').value,
                mediaBuying: document.getElementById('mediaBuying').checked,
                mediaBudget: +document.getElementById('mediaBudget').value,
                mediaSpent: +document.getElementById('mediaSpent').value,
                status: document.getElementById('status').value,
                deadline: document.getElementById('deadline').value,
                notes: document.getElementById('notes').value
            });

            document.getElementById('clientName').value = '';
            document.getElementById('postsReq').value = '0';
            document.getElementById('postsComp').value = '0';
            document.getElementById('reelsReq').value = '0';
            document.getElementById('reelsComp').value = '0';
            document.getElementById('storiesReq').value = '0';
            document.getElementById('storiesComp').value = '0';
            document.getElementById('mediaBuying').checked = false;
            document.getElementById('mediaBudget').value = '0';
            document.getElementById('mediaSpent').value = '0';
            document.getElementById('deadline').value = '';
            document.getElementById('notes').value = '';
            
            toggleForm();
            saveData();
        }

        function deleteClient(id) {
            if (confirm('هل أنت متأكد من حذف هذا العميل؟')) {
                clients = clients.filter(c => c.id !== id);
                saveData();
            }
        }

        function updateClient(id, field, value) {
            const client = clients.find(c => c.id === id);
            if (client) {
                client[field] = value;
                saveData();
            }
        }

        function getProgress(comp, req) {
            return req === 0 ? 0 : Math.round((comp / req) * 100);
        }

        function getStatusClass(status) {
            const map = {
                'جاري العمل': 'status-working',
                'في الانتظار': 'status-waiting',
                'مكتمل': 'status-complete',
                'متأخر': 'status-late',
                'ملغي': 'status-cancel'
            };
            return map[status] || 'status-working';
        }

        function render() {
            const container = document.getElementById('clientsList');
            
            if (clients.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="emoji">📊</div>
                        <p style="font-size: 20px; color: #666;">لا يوجد عملاء حالياً</p>
                        <p style="color: #999; margin-top: 10px;">اضغط على "عميل جديد" لإضافة أول عميل</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = clients.map(c => `
                <div class="client-card">
                    <div class="client-header">
                        <div>
                            <div class="client-title">${c.name}</div>
                            <select class="status-badge ${getStatusClass(c.status)}" 
                                    onchange="updateClient(${c.id}, 'status', this.value)">
                                <option value="جاري العمل" ${c.status === 'جاري العمل' ? 'selected' : ''}>جاري العمل</option>
                                <option value="في الانتظار" ${c.status === 'في الانتظار' ? 'selected' : ''}>في الانتظار</option>
                                <option value="مكتمل" ${c.status === 'مكتمل' ? 'selected' : ''}>مكتمل</option>
                                <option value="متأخر" ${c.status === 'متأخر' ? 'selected' : ''}>متأخر</option>
                                <option value="ملغي" ${c.status === 'ملغي' ? 'selected' : ''}>ملغي</option>
                            </select>
                            ${c.deadline ? `<p style="font-size: 13px; color: #666; margin-top: 8px;">⏰ الموعد: ${c.deadline}</p>` : ''}
                        </div>
                        <button class="btn-delete" onclick="deleteClient(${c.id})">🗑️ حذف</button>
                    </div>

                    <div class="content-grid">
                        <div class="content-box box-posts">
                            <h4><span class="dot"></span> البوستات</h4>
                            <div class="progress-numbers">
                                <input type="number" value="${c.postsComp}" 
                                       onchange="updateClient(${c.id}, 'postsComp', +this.value)">
                                <span>/</span>
                                <input type="number" value="${c.postsReq}" 
                                       onchange="updateClient(${c.id}, 'postsReq', +this.value)">
                                <strong>${getProgress(c.postsComp, c.postsReq)}%</strong>
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar progress-blue" style="width: ${getProgress(c.postsComp, c.postsReq)}%"></div>
                            </div>
                        </div>

                        <div class="content-box box-reels">
                            <h4><span class="dot"></span> الريلز</h4>
                            <div class="progress-numbers">
                                <input type="number" value="${c.reelsComp}" 
                                       onchange="updateClient(${c.id}, 'reelsComp', +this.value)">
                                <span>/</span>
                                <input type="number" value="${c.reelsReq}" 
                                       onchange="updateClient(${c.id}, 'reelsReq', +this.value)">
                                <strong>${getProgress(c.reelsComp, c.reelsReq)}%</strong>
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar progress-purple" style="width: ${getProgress(c.reelsComp, c.reelsReq)}%"></div>
                            </div>
                        </div>

                        <div class="content-box box-stories">
                            <h4><span class="dot"></span> الاستوريز</h4>
                            <div class="progress-numbers">
                                <input type="number" value="${c.storiesComp}" 
                                       onchange="updateClient(${c.id}, 'storiesComp', +this.value)">
                                <span>/</span>
                                <input type="number" value="${c.storiesReq}" 
                                       onchange="updateClient(${c.id}, 'storiesReq', +this.value)">
                                <strong>${getProgress(c.storiesComp, c.storiesReq)}%</strong>
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar progress-pink" style="width: ${getProgress(c.storiesComp, c.storiesReq)}%"></div>
                            </div>
                        </div>
                    </div>

                    <div class="media-box">
                        <div class="media-header">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" ${c.mediaBuying ? 'checked' : ''} 
                                       onchange="updateClient(${c.id}, 'mediaBuying', this.checked)"
                                       style="width: 20px; height: 20px;">
                                <strong>ميديا باينج</strong>
                            </div>
                            ${c.mediaBuying ? '<span class="media-badge">نشط ✓</span>' : ''}
                        </div>
                        ${c.mediaBuying ? `
                            <div class="media-grid">
                                <div class="media-item">
                                    <label>الميزانية الكلية</label>
                                    <input type="number" value="${c.mediaBudget}" 
                                           onchange="updateClient(${c.id}, 'mediaBudget', +this.value)">
                                </div>
                                <div class="media-item">
                                    <label>المصروف</label>
                                    <input type="number" value="${c.mediaSpent}" 
                                           onchange="updateClient(${c.id}, 'mediaSpent', +this.value)">
                                </div>
                                <div class="media-item">
                                    <label>المتبقي</label>
                                    <div class="remaining">${(c.mediaBudget - c.mediaSpent).toLocaleString()} ج</div>
                                </div>
                            </div>
                            <div class="progress-bar-container" style="margin-top: 15px;">
                                <div class="progress-bar progress-green" style="width: ${getProgress(c.mediaSpent, c.mediaBudget)}%"></div>
                            </div>
                        ` : ''}
                    </div>

                    <div class="notes-box">
                        <textarea placeholder="أضف ملاحظات..." 
                                  onchange="updateClient(${c.id}, 'notes', this.value)">${c.notes || ''}</textarea>
                    </div>
                </div>
            `).join('');
        }

        function exportCSV() {
            const headers = ['اسم العميل', 'البوستات المطلوبة', 'البوستات المنجزة', 'نسبة البوستات%', 'الريلز المطلوبة', 'الريلز المنجزة', 'نسبة الريلز%', 'الاستوريز المطلوبة', 'الاستوريز المنجزة', 'نسبة الاستوريز%', 'ميديا باينج', 'الميزانية', 'المصروف', 'المتبقي', 'الحالة', 'الموعد', 'ملاحظات'];
            
            const rows = clients.map(c => [
                c.name,
                c.postsReq,
                c.postsComp,
                getProgress(c.postsComp, c.postsReq),
                c.reelsReq,
                c.reelsComp,
                getProgress(c.reelsComp, c.reelsReq),
                c.storiesReq,
                c.storiesComp,
                getProgress(c.storiesComp, c.storiesReq),
                c.mediaBuying ? 'نعم' : 'لا',
                c.mediaBudget,
                c.mediaSpent,
                c.mediaBudget - c.mediaSpent,
                c.status,
                c.deadline || '',
                c.notes || ''
            ].join(','));

            const csv = '\ufeff' + [headers.join(','), ...rows].join('\n');
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `تقرير_العملاء_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        function saveBackup() {
            const blob = new Blob([JSON.stringify(clients, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `نسخة_احتياطية_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        function loadBackup(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        clients = JSON.parse(e.target.result);
                        saveData();
                        alert('تم تحميل البيانات بنجاح! ✓');
                    } catch (error) {
                        alert('خطأ في قراءة الملف!');
                    }
                };
                reader.readAsText(file);
            }
        }

        render();
    </script>
</body>
</html>